# watermeter
Use a neural network for image recognition to digitize your water meter and store the values in InfluxDB.
Tools used in this workflow:
  * [OpenCV](https://opencv.org/)
  * [Keras](https://keras.io/)
  * [InfluxDB](https://www.influxdata.com/)

You might want to check out [AI-on-the-edge-device](https://github.com/jomjol/AI-on-the-edge-device/) which is way more advanced and easiert to use water meter read-out approach using a ESP32-CAM.

## Hardware setup
Attach two webcams to e.g. a RaspberryPi, aim them at your cold and warm water meters
  * Raspberry Pi 4
  * Logitech C925e
![HardwareSetup](https://github.com/bolausson/watermeter/blob/main/misc/HardwareSetup.jpg?raw=true)

## Procedure
  * Adjust monitor-water.py to fit your needs (camera device, crop, etc)
  * Capture a bunch of images using monitor-water.py (set SAVE_FOR_TRAINING to True to capter just everything)
  * Training should be done on a system with CUDA enabled GPU.
  * Use the scripts in the "train" folder in order:

  0. To rsync the images generated by monitor-water.py to the "training" system
  1. View all images and assign them a value (We will use OpenCV do display the extracted features to manually assign a value according to what is in the picture)
  2. Review your work (I will display all characterized images to spot eventually miscahractericed images)
  3. Fix image <-> value asignment in case you screwd up in step 1 and found the mistake in step 2
  4. Append new images to the an existing image set (Python pickle file)
  5. Get some info about exiting image sets
  6. Train your model with the images in the image set
  7. Rsync test data (images which have not yet been seen by the model) to the training system
  8. Test your model

### Procedure in pictures
Step 1a  
![Step 1a](https://github.com/bolausson/watermeter/blob/main/misc/Step-01-a.png?raw=true)
Step 1b
![Step 1b](https://github.com/bolausson/watermeter/blob/main/misc/Step-01-b.png?raw=true)
Step 2
![Step 2](https://github.com/bolausson/watermeter/blob/main/misc/Step-02.png?raw=true)
Step 3
![Step 3](https://github.com/bolausson/watermeter/blob/main/misc/Step-03.png?raw=true)
Step 4
![Step 4](https://github.com/bolausson/watermeter/blob/main/misc/Step-04.png?raw=true)
Step 5
![Step 5](https://github.com/bolausson/watermeter/blob/main/misc/Step-05.png?raw=true)
Step 6
![Step 6](https://github.com/bolausson/watermeter/blob/main/misc/Step-06.png?raw=true)
Step 8
![Step 8](https://github.com/bolausson/watermeter/blob/main/misc/Step-08.png?raw=true)

## Grafana dashboard screenshot
![Grafana dashboard screenshot](https://github.com/bolausson/watermeter/blob/main/misc/Grafana-Dashboard-Screenshot.png?raw=true)

## Running on Raspberry Pi 4
![Running on Raspberry Pi 4](https://github.com/bolausson/watermeter/blob/main/misc/visualization.png?raw=true)
